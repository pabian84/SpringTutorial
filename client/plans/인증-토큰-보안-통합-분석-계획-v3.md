# ì¸ì¦/í† í°/ë³´ì•ˆ í†µí•© ë¶„ì„ ë° ê°œì„  ê³„íš (v3.0 ìˆ˜ì •ë³¸)

## ğŸ“… ë¬¸ì„œ ì •ë³´

- **ë²„ì „**: 3.0
- **ì‘ì„±ì¼**: 2026-02-06
- **ì‘ì„±ì**: AI Assistant
- **ëŒ€ìƒ í”„ë¡œì íŠ¸**: SpringTutorial (í”„ë¡ íŠ¸ì—”ë“œ + ë°±ì—”ë“œ)
- **íŠ¹ì´ì‚¬í•­**: v2.0ì—ì„œ ë°œìƒí–ˆë˜ ëª¨ë“ˆí™” ì˜¤ë¥˜ ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ì „ë©´ ì¬ë¶„ì„ ë²„ì „

---

## ğŸ” 1. í˜„ì¬ ì•„í‚¤í…ì²˜ ê°œìš”

### 1.1 ì‹œìŠ¤í…œ êµ¬ì„±

```mermaid
flowchart TD
    subgraph "í”„ë¡ íŠ¸ì—”ë“œ client"
        A1[Login.tsx]
        A2[authUtility.ts]
        A3[AuthProvider.tsx]
        A4[axiosConfig.ts]
        A5[WebSocketProvider.tsx]
    end
    
    subgraph "ë°±ì—”ë“œ server - Port 8080"
        B1[UserController]
        B2[SessionController]
        B3[SessionService]
        B4[JwtAuthenticationFilter]
        B5[JwtTokenProvider]
        B6[SecurityConfig]
    end
    
    subgraph "ë°ì´í„°ë² ì´ìŠ¤"
        C1[user_sessions í…Œì´ë¸”]
        C2[users í…Œì´ë¸”]
    end
    
    A1 --> A2
    A2 --> A3
    A3 --> A4
    A4 --> A5
    
    A1 -->|POST /api/user/login| B1
    A4 -->|API ìš”ì²­| B4
    A5 -->|WebSocket| B4
    
    B1 --> B3
    B2 --> B3
    B3 --> C1
    B4 --> C1
    B5 --> B4
    B6 --> B4
```

### 1.2 í† í° êµ¬ì¡°

| í† í° | ì €ì¥ì†Œ | ë§Œë£Œ ì‹œê°„ | ìš©ë„ |
|------|--------|----------|------|
| **Access Token** | localStorage | í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ê°€ëŠ¥ | API ìš”ì²­ ì¸ì¦ |
| **Refresh Token** | HttpOnly Cookie | 7ì¼ (604800ì´ˆ) | Access Token ê°±ì‹  |

### 1.3 í˜„ì¬ í¬íŠ¸ ì„¤ì • (ìœ ì§€ í•„ìˆ˜)

| í¬íŠ¸ | í”„ë¡œí† ì½œ | ìš©ë„ |
|------|----------|------|
| 5173 | HTTP | ê°œë°œ í™˜ê²½ HTTP |
| 5174 | HTTPS | ê°œë°œ í™˜ê²½ HTTPS |

**npm run dev** ì‹¤í–‰ ì‹œ ë‘ í¬íŠ¸ê°€ ë™ì‹œì— ì‹¤í–‰ë¨ (package.json ì„¤ì • ìœ ì§€)

---

## âš ï¸ 2. ë°œê²¬ëœ ë¬¸ì œì  ì¢…í•©

### ğŸ› ë°œê²¬ëœ ë²„ê·¸ (ì¦‰ì‹œ ìˆ˜ì • í•„ìš”)

| # | ë¬¸ì œ | ìœ„ì¹˜ | ì›ì¸ | ì‹¬ê°ë„ |
|---|------|------|------|--------|
| 1 | **ëª¨ë“  ê¸°ê¸° ë¡œê·¸ì•„ì›ƒ í›„ 403 ë¬´í•œ ë£¨í”„** | `axiosConfig.ts:118` | 403 ì—ëŸ¬ì—ì„œ logout() ì¬í˜¸ì¶œ â†’ ë¬´í•œ ë£¨í”„ | ğŸ”´ ë†’ìŒ |
| 2 | **logout ì¤‘ë³µ API í˜¸ì¶œ** | `authUtility.ts:204` | logout()ì—ì„œ sessionApi.logout() í˜¸ì¶œ í›„ axios interceptorì—ì„œ ë‹¤ì‹œ logout() í˜¸ì¶œ | ğŸ”´ ë†’ìŒ |
| 3 | **ëŒ€ì‹œë³´ë“œ ë¡œê·¸ì•„ì›ƒ í›„ ì´ë™í•˜ì§€ ì•ŠìŒ** | `AuthProvider.tsx` | logout í•¨ìˆ˜ì—ì„œ ìƒíƒœ ì •ë¦¬ í›„ navigate í˜¸ì¶œæ—¶æœº ë¬¸ì œ | ğŸŸ¡ ì¤‘ê°„ |
| 4 | **logout -> logout ì¤‘ì²©** | `AuthProvider.tsx` | logout() í˜¸ì¶œ â†’ utilityLogout() â†’ axios 403 â†’ logout() | ğŸŸ¡ ì¤‘ê°„ |

### ì²´í¬ë¦¬ìŠ¤íŠ¸

| # | ë¬¸ì œ | ìœ„ì¹˜ | ì²´í¬ |
|---|------|------|------|
| 1 | **í…ŒìŠ¤íŠ¸ ëª¨ë“œ í† í° ì‹œê°„ ì„¤ì •** | [`authUtility.ts:13`](src/utils/authUtility.ts:13), application.yml | â˜ í† í° ì‹œê°„ 10ì´ˆ/30ì´ˆë¡œ ì¡°ì ˆ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸ |
| 2 | **ì¿ í‚¤ SameSite ë¶ˆì¼ì¹˜** | [`UserController.java`](../server/src/main/java/com/example/demo/domain/user/controller/UserController.java), [`SessionController.java`](../server/src/main/java/com/example/demo/domain/user/controller/SessionController.java), [`authUtility.ts:160`](src/utils/authUtility.ts:160) | â˜ í¬ë¡œìŠ¤ì˜¤ë¦¬ì§„ ì¿ í‚¤ ì „ì†¡ í™•ì¸ |
| 3 | **Refresh Token Rotation ë¯¸êµ¬í˜„** | [`SessionService.java`](../server/src/main/java/com/example/demo/domain/user/service/SessionService.java) | â˜ í† í°Rotation ì ìš© ì—¬ë¶€ í™•ì¸ |
| 4 | **window.location.href ì‚¬ìš©** | [`authUtility.ts:196`](src/utils/authUtility.ts:196) | â˜ navigate()ë¡œ ë³€ê²½ í•„ìš” (ì™„ë£Œ) |
| 5 | **ì½”ë“œ ì¤‘ë³µ** | [`authUtility.ts`](src/utils/authUtility.ts) vs [`AuthProvider.tsx`](src/contexts/AuthProvider.tsx) | â˜ ë¦¬íŒ©í† ë§ í•„ìš” |
| 6 | **ì¬ì—°ê²° ë¡œì§** | [`WebSocketProvider.tsx:109`](src/contexts/WebSocketProvider.tsx:109) | â˜ ì¬ì‹œë„ ë¡œì§ í™•ì¸ |

---

## ğŸ“‹ 3. Phase 1: ê¸´ê¸‰ ìˆ˜ì • (ì¸ì¦ íë¦„ ìˆ˜ì •)

### 3.0 ë²„ê·¸ ìˆ˜ì • (ì¬ë¶„ì„ ì¤‘ ë°œê²¬)

#### ğŸ› ë²„ê·¸ 1: 403 ë¬´í•œ ë£¨í”„ ìˆ˜ì •

**ë¬¸ì œ:** axios interceptor 403 ì²˜ë¦¬ì—ì„œ logout() ì¬í˜¸ì¶œ â†’ ë¬´í•œ ë£¨í”„

**ìˆ˜ì • ëŒ€ìƒ:** [`src/utils/axiosConfig.ts`](src/utils/axiosConfig.ts)

```typescript
// ========== BEFORE (line 96-120) ==========
// 403 ì ‘ê·¼ ê±°ë¶€
if (status === 403) {
  if (isRefreshing()) {
    return new Promise((resolve) => {
      addRefreshSubscriber((token: string) => {
        // ...
      });
    });
  }
  
  if (errorCode === 'A006') {
    showToast("ë³¸ì¸ì˜ ê¸°ê¸°ë§Œ ë¡œê·¸ì•„ì›ƒ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.", "error");
  } else {
    showToast("ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.", "error");  // â† ê³„ì† í˜¸ì¶œë¨
  }
  logout();  // â† 403ì—ì„œ logout() í˜¸ì¶œ â†’ ë¬´í•œ ë£¨í”„
  return Promise.reject(error);
}

// ========== AFTER ==========
// 403 ì ‘ê·¼ ê±°ë¶€
if (status === 403) {
  // ì´ë¯¸ logout ì¤‘ì´ë©´ ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€
  if (isRefreshing()) {
    return new Promise((resolve) => {
      addRefreshSubscriber((token: string) => {
        // ...
      });
    });
  }
  
  // í† í°ì´ ì´ë¯¸ ì •ë¦¬ë˜ì—ˆìœ¼ë©´ ì¤‘ë³µ ë¡œê·¸ì•„ì›ƒ ë°©ì§€
  const token = localStorage.getItem('accessToken');
  if (!token) {
    // ì´ë¯¸ ë¡œê·¸ì•„ì›ƒ ìƒíƒœ
    return Promise.reject(error);
  }
  
  if (errorCode === 'A006') {
    showToast("ë³¸ì¸ì˜ ê¸°ê¸°ë§Œ ë¡œê·¸ì•„ì›ƒ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.", "error");
  } else {
    showToast("ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.", "error");
  }
  logout();
  return Promise.reject(error);
}
```

#### ğŸ› ë²„ê·¸ 2: logout API ì¤‘ë³µ í˜¸ì¶œ ìˆ˜ì •

**ë¬¸ì œ:** logout()ì—ì„œ sessionApi.logout() í˜¸ì¶œ í›„ axios interceptorì—ì„œ ë‹¤ì‹œ logout() í˜¸ì¶œ

**ìˆ˜ì • ëŒ€ìƒ:** [`src/utils/authUtility.ts`](src/utils/authUtility.ts)

```typescript
// ========== BEFORE (line 184-214) ==========
export const logout = async (reason?: string): Promise<void> => {
  // í† ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ë³´ì—¬ì£¼ê³  ëŒ€ê¸°
  if (reason) {
    showToast(reason, 'error');
  }
  
  await new Promise(resolve => setTimeout(resolve, 1000));
  
  // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬
  localStorage.removeItem('accessToken');
  // ...
  
  // ì„œë²„ ë¡œê·¸ì•„ì›ƒ API í˜¸ì¶œ
  try {
    await sessionApi.logout();  // â† ì—¬ê¸°ì„œ 403 ë°œìƒ ê°€ëŠ¥
  } catch {
    // ì„œë²„ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨í•´ë„ í´ë¼ì´ì–¸íŠ¸ ì¸¡ ë¡œê·¸ì•„ì›ƒì€ ìˆ˜í–‰
  }
  
  deleteRefreshTokenCookie();
  redirectToLogin();
};

// ========== AFTER ==========
let isLoggingOut = false;

export const logout = async (reason?: string): Promise<void> => {
  // ì´ë¯¸ ë¡œê·¸ì•„ì›ƒ ì¤‘ì´ë©´ ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€
  if (isLoggingOut) {
    return;
  }
  isLoggingOut = true;
  
  try {
    // í† ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ë³´ì—¬ì£¼ê³  ëŒ€ê¸°
    if (reason) {
      showToast(reason, 'error');
    }
    
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬ (ë¨¼ì € ì •ë¦¬)
    localStorage.removeItem('accessToken');
    localStorage.removeItem('myId');
    localStorage.removeItem(TOKEN_EXPIRY_KEY);
    localStorage.removeItem(TOKEN_REFRESHING_KEY);
    
    refreshSubscribers = [];
    
    // ì¿ í‚¤ ì‚­ì œ
    deleteRefreshTokenCookie();
    
    // ì„œë²„ ë¡œê·¸ì•„ì›ƒ API í˜¸ì¶œ (ë¡œì»¬ ì •ë¦¬ í›„)
    // æ³¨æ„: ì´ë¯¸ í† í°ì´ ì •ë¦¬ë˜ì—ˆìœ¼ë¯€ë¡œ 403ì´ ë°œìƒí•´ë„ interceptorì—ì„œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
    try {
      await sessionApi.logout();
    } catch {
      // ì„œë²„ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨í•´ë„ í´ë¼ì´ì–¸íŠ¸ ì¸¡ ë¡œê·¸ì•„ì›ƒì€ ì´ë¯¸ ì™„ë£Œ
    }
    
    // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
    redirectToLogin();
  } finally {
    isLoggingOut = false;
  }
};
```

#### ğŸ› ë²„ê·¸ 3: AuthProvider logout ì¤‘ì²© ë°©ì§€

**ë¬¸ì œ:** AuthProvider.logout() â†’ utilityLogout() â†’ axios 403 â†’ logout() ì¤‘ì²©

**ìˆ˜ì • ëŒ€ìƒ:** [`src/contexts/AuthProvider.tsx`](src/contexts/AuthProvider.tsx)

```typescript
// ========== BEFORE (line 45-52) ==========
const logout = useCallback(async (reason?: string) => {
  // ë¨¼ì € ë¡œì»¬ ìƒíƒœ ì •ë¦¬
  setAccessToken(null);
  setMyId(null);
  
  // utilityLogoutì€ ë¹„ë™ê¸°ì´ë¯€ë¡œ await
  await utilityLogout(reason);
}, []);

// ========== AFTER ==========
const logout = useCallback(async (reason?: string) => {
  // ë¨¼ì € ë¡œì»¬ ìƒíƒœ ì •ë¦¬ (ì¤‘ìš”: API í˜¸ì¶œ ì „ì— ì •ë¦¬)
  setAccessToken(null);
  setMyId(null);
  
  // utilityLogout í˜¸ì¶œ (ì¤‘ë³µ í˜¸ì¶œì€ utility ë‚´ë¶€ì—ì„œ ë°©ì§€)
  await utilityLogout(reason);
}, []);
```

### 3.1 authUtility.ts - navigate()ë¡œ ë³€ê²½

#### ëª©í‘œ
- `window.location.href = '/'`ë¥¼ `navigate('/')`ë¡œ ë³€ê²½
- í˜ì´ì§€ ê¹œë¹¡ì„ ë°©ì§€, UX ê°œì„ 

#### ìˆ˜ì • ëŒ€ìƒ íŒŒì¼

**[`src/utils/authUtility.ts`](src/utils/authUtility.ts)**

```typescript
// ========== BEFORE ==========
import { sessionApi } from '../api/sessionApi';
import { showToast } from './Alert';

// ... (ì¤‘ëµ)

// ========== AFTER ==========
import { sessionApi } from '../api/sessionApi';
import { showToast } from './Alert';
import { useNavigate } from 'react-router-dom';

// React Routerì˜ navigateë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ë˜í¼
let navigateInstance: ((path: string) => void) | null = null;

export const setNavigate = (navigate: (path: string) => void): void => {
  navigateInstance = navigate;
};

// ë¡œê·¸ì¸ í˜ì´ì§€ ë¦¬ë‹¤ì´ë ‰íŠ¸
const redirectToLogin = (): void => {
  if (navigateInstance) {
    navigateInstance('/');
  } else {
    // navigateê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° fallback
    console.warn('[authUtility] navigateê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ, href ì‚¬ìš©');
    window.location.href = '/';
  }
};

// ========== BEFORE (logout í•¨ìˆ˜) ==========
export const logout = async (reason?: string): Promise<void> => {
  // ... (ì¤‘ëµ)
  
  if (window.location.pathname !== '/') {
    window.location.href = '/';  // â† ì´ ë¶€ë¶„ ìˆ˜ì •
  }
};

// ========== AFTER (logout í•¨ìˆ˜) ==========
export const logout = async (reason?: string): Promise<void> => {
  // ... (ì¤‘ëµ)
  
  redirectToLogin();
};
```

### 3.2 AuthProvider.tsx - navigate ì„¤ì •

**[`src/contexts/AuthProvider.tsx`](src/contexts/AuthProvider.tsx)**

```typescript
// ========== BEFORE ==========
import { createContext, useContext, useState, useEffect } from 'react';
import { sessionApi } from '../api/sessionApi';

// ... (ì¤‘ëµ)

// ========== AFTER ==========
import { createContext, useContext, useState, useEffect } from 'react';
import { sessionApi } from '../api/sessionApi';
import { useNavigate } from 'react-router-dom';
import { setNavigate } from '../utils/authUtility';

// ... (ì¤‘ëµ)

export const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const navigate = useNavigate();
  
  useEffect(() => {
    // authUtilityì— navigate í•¨ìˆ˜ ì„¤ì •
    setNavigate((path: string) => navigate(path));
  }, [navigate]);
  
  // ... (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
};
```

---

## âœ… Phase 1 ì™„ë£Œ (2026-02-06) - ê¸´ê¸‰ ìˆ˜ì •

### ì™„ë£Œëœ ì‘ì—…

| # | ì‘ì—… ë‚´ìš© | íŒŒì¼ | ìƒíƒœ |
|---|---------|------|------|
| 1 | **403 ë¬´í•œ ë£¨í”„ í•´ê²°** | [`axiosConfig.ts`](src/utils/axiosConfig.ts) | ì™„ë£Œ |
| 2 | **ì¤‘ì‹¬í™”ëœ logout í•¨ìˆ˜** | [`authUtility.ts`](src/utils/authUtility.ts) | ì™„ë£Œ |
| 3 | **isLoggingOut í”Œë˜ê·¸** | [`authUtility.ts:178`](src/utils/authUtility.ts:178) | ì™„ë£Œ |
| 4 | **emitLogoutEvent ì¶”ê°€** | [`authUtility.ts:167`](src/utils/authUtility.ts:167) | ì™„ë£Œ |
| 5 | **GlobalLogoutHandler** | [`App.tsx:16`](src/App.tsx:16) | ì™„ë£Œ |
| 6 | **WebSocket authLogout ë¦¬ìŠ¤ë„ˆ** | [`WebSocketProvider.tsx:133`](src/contexts/WebSocketProvider.tsx:133) | ì™„ë£Œ |
| 7 | **Login.tsx forceReconnect** | [`Login.tsx:14`](src/pages/Login.tsx:14) | ì™„ë£Œ |
| 8 | **pathname ì²´í¬ ì œê±°** | [`WebSocketProvider.tsx:20`](src/contexts/WebSocketProvider.tsx:20) | ì™„ë£Œ |
| 9 | **ë°±ì—”ë“œ IllegalStateException** | [`WebSocketHandler.java:123`](../server/src/main/java/com/example/demo/handler/WebSocketHandler.java:123) | ì™„ë£Œ |
| 10 | **ESLint í†µê³¼** | ì „ì—­ | ì™„ë£Œ |

### í•µì‹¬ ë³€ê²½ ì‚¬í•­

**1. authUtility.ts - logout í•¨ìˆ˜**
```typescript
let isLoggingOut = false;

export const logout = async (reason?: string): Promise<void> => {
  if (isLoggingOut) return;
  isLoggingOut = true;
  
  if (reason) {
    showToast(reason, 'error');
  }
  
  await new Promise(resolve => setTimeout(resolve, 1000));
  
  localStorage.removeItem('accessToken');
  localStorage.removeItem('myId');
  localStorage.removeItem(TOKEN_EXPIRY_KEY);
  localStorage.removeItem(TOKEN_REFRESHING_KEY);
  refreshSubscribers = [];
  
  deleteRefreshTokenCookie();
  
  emitLogoutEvent();
  
  try {
    await sessionApi.logout();
  } catch {
    // ì‹¤íŒ¨í•´ë„ í´ë¼ì´ì–¸íŠ¸ ë¡œê·¸ì•„ì›ƒì€ ì™„ë£Œ
  }
  
  isLoggingOut = false;
};
```

**2. App.tsx - GlobalLogoutHandler**
```typescript
function GlobalLogoutHandler() {
  const navigate = useNavigate();
  
  useEffect(() => {
    const handleLogout = () => {
      navigate('/', { replace: true });
    };
    window.addEventListener('authLogout', handleLogout);
    return () => window.removeEventListener('authLogout', handleLogout);
  }, [navigate]);
  
  return null;
}
```

**3. WebSocketProvider.tsx - pathname ì²´í¬ ì œê±°**
```typescript
const connectSocket = useCallback(() => {
  // í† í°ì´ ì—†ìœ¼ë©´ ì—°ê²°í•˜ì§€ ì•ŠìŒ (pathname ì²´í¬ ì œê±°)
  const token = localStorage.getItem('accessToken');
  let myId = localStorage.getItem('myId');
  
  if (!token || !myId) {
    return;
  }
  // ... ì—°ê²° ë¡œì§
}, [WS_URL]);
```

**4. WebSocketHandler.java - ë ˆì´ìŠ¤ ì»¨ë””ì…˜ ë°©ì§€**
```java
public void broadcastToTarget(WebSocketSession session, TextMessage message) {
  synchronized (session) {
    if (!session.isOpen()) {
      return;
    }
    try {
      session.sendMessage(message);
    } catch (IllegalStateException e) {
      log.debug("ë©”ì‹œì§€ ì „ì†¡ ì¤‘ ì„¸ì…˜å…³é—­ (ì •ìƒ): {}", session.getId());
    } catch (IOException e) {
      log.debug("ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨: {}", session.getId());
    }
  }
}
```

---

## ğŸ“‹ 4. Phase 2: í”„ë¡œì íŠ¸ ì¬ë¶„ì„

### 4.1 í˜„ì¬ í”„ë¡œì íŠ¸ êµ¬ì¡° ë¶„ì„

```mermaid
flowchart TD
    subgraph "src ë””ë ‰í† ë¦¬ ë¶„ì„"
        A1[api/] --> A1a[sessionApi.ts]
        A1 --> A1b[userApi.ts]
        A1 --> A1c[widgetApi.ts]
        
        A2[auth/] --> A2a[types.ts]
        A2 --> A2b[tokenManager.ts]
        A2 --> A2c[AuthContext.tsx]
        A2 --> A2d[index.ts]
        
        A3[contexts/] --> A3a[AuthContext.tsx]
        A3 --> A3b[AuthProvider.tsx]
        A3 --> A3c[WebSocketContext.tsx]
        A3 --> A3d[WebSocketProvider.tsx]
        
        A4[utils/] --> A4a[authUtility.ts]
        A4 --> A4b[axiosConfig.ts]
        A4 --> A4c[Alert.tsx]
    end
    
    subgraph "ì¤‘ë³µ ë¶„ì„"
        B1[auth/] === B2[contexts/]
        B1 --> |ì½”ë“œ ì¤‘ë³µ| B3[authUtility.ts]
    end
```

### 4.2 ì¸ì¦ ê´€ë ¨ íŒŒì¼ ë§¤í•‘

| ê¸°ëŠ¥ | íŒŒì¼ | ìƒíƒœ |
|------|------|------|
| í† í° ê´€ë¦¬ | [`auth/tokenManager.ts`](src/auth/tokenManager.ts) | ë¶„ì„ í•„ìš” |
| í† í° ê´€ë¦¬ | [`utils/authUtility.ts`](src/utils/authUtility.ts) | ë¶„ì„ í•„ìš” |
| ì¸ì¦ ì»¨í…ìŠ¤íŠ¸ | [`auth/AuthContext.tsx`](src/auth/AuthContext.tsx) | ë¶„ì„ í•„ìš” |
| ì¸ì¦ í”„ë¡œë°”ì´ë” | [`contexts/AuthProvider.tsx`](src/contexts/AuthProvider.tsx) | ë¶„ì„ í•„ìš” |
| ì„¸ì…˜ API | [`api/sessionApi.ts`](src/api/sessionApi.ts) | ë¶„ì„ í•„ìš” |
| axios ì„¤ì • | [`utils/axiosConfig.ts`](src/utils/axiosConfig.ts) | ë¶„ì„ í•„ìš” |

---

## ğŸ“‹ 5. Phase 3: ë³´ì•ˆ ê°•í™” (ì¬ë¶„ì„ í›„ ì§„í–‰)

### 5.1 Refresh Token Rotation

#### ë©€í‹°ë””ë°”ì´ìŠ¤ í˜¸í™˜ì„±

**í˜„ì¬ ì„¤ê³„**: í•œ ì•„ì´ë””ë¡œ ì—¬ëŸ¬ ë””ë°”ì´ìŠ¤/í”„ë¡œí•„ì—ì„œ ë™ì‹œ ì ‘ì† ê°€ëŠ¥

**Refresh Token Rotation ì ìš© ì‹œ**: ë¬¸ì œ ì—†ìŒ âœ…

| ë””ë°”ì´ìŠ¤ | ì„¸ì…˜ ID | Refresh Token | Rotation ì ìš© ì‹œ | ì˜í–¥ |
|----------|---------|---------------|------------------|------|
| PC-Chrome | session_001 | refresh_A | session_001ì˜ RTë§Œ ê°±ì‹  | âœ… ë‹¤ë¥¸ ë””ë°”ì´ìŠ¤ ì˜í–¥ ì—†ìŒ |
| Phone-Safari | session_002 | refresh_B | session_002ì˜ RTë§Œ ê°±ì‹  | âœ… ë‹¤ë¥¸ ë””ë°”ì´ìŠ¤ ì˜í–¥ ì—†ìŒ |
| Tablet-Edge | session_003 | refresh_C | session_003ì˜ RTë§Œ ê°±ì‹  | âœ… ë‹¤ë¥¸ ë””ë°”ì´ìŠ¤ ì˜í–¥ ì—†ìŒ |

**ì™œëƒí•˜ë©´:**
- ê° ë””ë°”ì´ìŠ¤ëŠ” ê³ ìœ í•œ `session_id`ë¥¼ ê°€ì§
- Refresh Token Rotationì€ **ì„¸ì…˜ ë‹¨ìœ„**ë¡œ ì‘ë™
- DBì˜ `user_sessions` í…Œì´ë¸”ì´ `session_id`ë¡œ êµ¬ë¶„

#### ì£¼ì˜ì‚¬í•­

**ê°™ì€ ë¸Œë¼ìš°ì €ì˜ ì—¬ëŸ¬ íƒ­ì—ì„œ ë™ì¼ ì„¸ì…˜ ì‚¬ìš© ì‹œ:**
- ì²« ë²ˆì§¸ íƒ­ì´ í† í° ê°±ì‹  â†’ ë‘ ë²ˆì§¸ íƒ­ì˜ Refresh Token ë¬´íš¨í™”
- ì´ê²ƒì€ **ë³´ì•ˆìƒ ì •ìƒ ë™ì‘** (í† í° íƒˆì·¨ ë°©ì§€)

#### êµ¬í˜„ ë²”ìœ„

| íŒŒì¼ | ìˆ˜ì • ë‚´ìš© |
|------|----------|
| `RefreshSessionRes.java` | refreshToken í•„ë“œ ì¶”ê°€ |
| `SessionService.java` | ìƒˆ Refresh Token ë°œê¸‰ ë° DB ì—…ë°ì´íŠ¸ |
| `SessionMapper.java` | updateRefreshToken ë©”ì„œë“œ ì¶”ê°€ |
| `SessionMapper.xml` | UPDATE ì¿¼ë¦¬ ì¶”ê°€ |
| `authUtility.ts` | ìƒˆ Refresh Token ì¿ í‚¤ ë™ê¸°í™” ì²˜ë¦¬ |

### 5.2 ì¿ í‚¤ SameSite í†µì¼

### 5.3 ì¬ì—°ê²° ë¡œì§ ê°œì„ 

### 5.4 ì—ëŸ¬ ì²˜ë¦¬ í†µí•©

---

## ğŸ“‹ 6. Phase 4: ëª¨ë“ˆí™” (ë§ˆì§€ë§‰ ë‹¨ê³„)

### 6.1 ì¸ì¦ ëª¨ë“ˆ ë¶„ë¦¬

### 6.2 í…ŒìŠ¤íŠ¸ í†µí•©

---

## ğŸ“‹ 7. ì‹¤í–‰ ìˆœì„œ (Todo List)

### Phase 1: ê¸´ê¸‰ ìˆ˜ì • âœ… ì™„ë£Œ
- [x] 3.1 authUtility.ts - navigate() ë˜í¼ ì¶”ê°€ ë° logout ìˆ˜ì •
- [x] 3.2 AuthProvider.tsx - navigate ì„¤ì • ì¶”ê°€
- [x] WebSocket ì—°ê²° ì•ˆì •í™” (pathname ì²´í¬ ì œê±°)
- [x] ë°±ì—”ë“œ IllegalStateException ì²˜ë¦¬
- [x] ESLint í†µê³¼ í™•ì¸

### Phase 2: í”„ë¡œì íŠ¸ ì¬ë¶„ì„
- [ ] 4.1 í˜„ì¬ í”„ë¡œì íŠ¸ ì „ì²´ êµ¬ì¡° ë¶„ì„
- [ ] 4.2 ì¸ì¦ ê´€ë ¨ íŒŒì¼ë³„ ê¸°ëŠ¥ ë§¤í•‘
- [ ] ì¤‘ë³µ ì½”ë“œ ì‹ë³„ ë° í†µí•© ê³„íš ìˆ˜ë¦½

### Phase 3: ë³´ì•ˆ ê°•í™” (ì¬ë¶„ì„ í›„ ì§„í–‰)
- [ ] Refresh Token Rotation ì ìš©
- [ ] ì¿ í‚¤ SameSite í†µì¼
- [ ] ì¬ì—°ê²° ë¡œì§ ê°œì„ 
- [ ] ì—ëŸ¬ ì²˜ë¦¬ í†µí•©

### Phase 4: ëª¨ë“ˆí™” (ë§ˆì§€ë§‰)
- [ ] ì¸ì¦ ëª¨ë“ˆ ë¶„ë¦¬
- [ ] í…ŒìŠ¤íŠ¸ í†µí•©

---

## ğŸ“‹ 8. ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì‹œì‘ ì „ í™•ì¸ì‚¬í•­
- [x] í…ŒìŠ¤íŠ¸ ëª¨ë“œ í† í° ì‹œê°„ (10ì´ˆ/30ì´ˆ) ì¡°ì ˆ ê°€ëŠ¥ í™•ì¸
- [x] http/https ë™ì‹œ ì‹¤í–‰ ì„¤ì • ìœ ì§€ í™•ì¸ (package.json)
- [x] navigate() ë³€ê²½ìœ¼ë¡œ UX ê°œì„  í™•ì¸

### ìˆ˜ì • í›„ í™•ì¸ì‚¬í•­
- [x] ë¡œê·¸ì•„ì›ƒ ì‹œ í˜ì´ì§€ ê¹œë¹¡ì„ ì—†ìŒ
- [x] í† ìŠ¤íŠ¸ ë©”ì‹œì§€ê°€ ì •ìƒì ìœ¼ë¡œ í‘œì‹œë¨
- [x] HTTP/HTTPS í¬íŠ¸ ëª¨ë‘ ì •ìƒ ë™ì‘
- [x] WebSocket ì—°ê²° ì •ìƒ ë™ì‘
- [x] ê¸°ê¸° ë¡œê·¸ì•„ì›ƒ/ì „ì²´ ë¡œê·¸ì•„ì›ƒ ì •ìƒ ë™ì‘
