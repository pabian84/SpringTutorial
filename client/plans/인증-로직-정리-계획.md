# 인증 로직 정리 계획

## 1. 현재 문제점 분석

### 1.1 AuthProvider.tsx 문제점

| 위치 | 문제 | 설명 |
|------|------|------|
| line 136-156 | 중복 인증 확인 | `location.pathname` 변경 시마다 인증 확인 실행 |
| line 161-202 | 중복 인증 확인 | 마운트 시에도 인증 확인 실행 |
| line 152 | 불필요한 토스트 | `로그인이 필요합니다, ${location.pathname}` - 경로까지 표시 |
| line 168 | 불필요한 토스트 | `인증실패(${message})(${url}), 로그아웃` - URL까지 표시 |
| line 169 | 주석 처리된 코드 | `//handleLogout(message + url);` |

### 1.2 axiosConfig.ts 문제점

| 위치 | 문제 | 설명 |
|------|------|------|
| line 157 | 디버깅용 토스트 | `showToast('요청 인터셉터')` - 의미 없는 메시지 |
| line 226 | 불필요한 토스트 | 404 에러 시 `데이터를 찾을 수 없습니다.` |
| line 191, 208 | 중복 토스트 가능성 | `handleAuthError`에서 `onAuthFailed` 호출 시 토스트 중복 |

### 1.3 인증 플로우 문제

```
현재 플로우 (복잡함):
1. 페이지 이동 → checkAuthStatus() 호출
2. 마운트 → checkAuthStatus() 호출
3. API 401 → handleAuthError() → checkAuthStatus() 호출
4. onAuthFailed → 토스트 표시
5. AuthProvider → 토스트 표시 (중복)
```

## 2. 개선 방안

### 2.1 인증 확인 로직 단순화

**Before:**
```typescript
// useEffect 1: 경로 변경 시 인증 확인
useEffect(() => {
  checkAuthStatus().then(...)
}, [location.pathname]);

// useEffect 2: 마운트 시 인증 확인
useEffect(() => {
  checkAuthStatus().then(...)
}, []);
```

**After:**
```typescript
// 단일 useEffect: 마운트 시에만 인증 확인
// 페이지 이동 시에는 axios interceptor가 401을 처리
useEffect(() => {
  checkAuthStatus().then(...)
}, []);
```

### 2.2 토스트 메시지 정리

**제거할 메시지:**
- `요청 인터셉터` (axiosConfig.ts line 157)
- `데이터를 찾을 수 없습니다.` (axiosConfig.ts line 226)
- `로그인이 필요합니다, ${location.pathname}` (AuthProvider.tsx line 152)
- `인증실패(${message})(${url}), 로그아웃` (AuthProvider.tsx line 168)

**유지할 메시지:**
- 로그인 성공: `환영합니다, ${user.name}님!`
- 세션 만료: `세션이 만료되었습니다.` (axiosConfig에서만)
- 로그아웃 사유: 사용자가 로그아웃한 경우에만

### 2.3 인증 실패 처리 단순화

**Before:**
```
API 401 → handleAuthError → onAuthFailed(토스트) → AuthProvider(토스트) → navigate
```

**After:**
```
API 401 → handleAuthError → onAuthFailed(토스트 1회만) → navigate
```

## 3. 수정 파일 목록

### 3.1 src/contexts/AuthProvider.tsx
- [ ] 중복 인증 확인 useEffect 제거 (line 136-156)
- [ ] 불필요한 토스트 메시지 제거
- [ ] 주석 처리된 코드 제거
- [ ] onAuthFailed 콜백 단순화

### 3.2 src/utils/axiosConfig.ts
- [ ] 디버깅용 토스트 제거 (line 157)
- [ ] 404 토스트 제거 (line 226)
- [ ] handleAuthError에서 토스트 표시 후 onAuthFailed는 navigate만 담당

## 4. 예상 효과

1. **토스트 메시지 감소**: 인증 관련 토스트가 1회만 표시됨
2. **불필요한 API 호출 감소**: 페이지 이동 시마다 인증 확인하지 않음
3. **코드 가독성 향상**: 중복 로직 제거
4. **디버깅 용이**: 로그가 단순해짐

## 5. 실행 순서

1. axiosConfig.ts 수정 (토스트 제거)
2. AuthProvider.tsx 수정 (중복 로직 제거)
3. 테스트 및 검증
