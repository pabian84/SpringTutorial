# 인증 리다이렉트 방식 비교 분석

## 문제 상황

- 인증된 사용자가 `/` (로그인 페이지)로 이동하면 로그인 페이지에 머묾
- httpOnly 쿠키는 JavaScript에서 직접 확인 불가
- 서버 응답 전까지 인증 상태를 모름

---

## 해결 방안 비교

### 1. AuthProvider 최적화

**설명**
- 초기 인증 확인 (`/me` API) 속도 개선
- 네트워크 요청 최소화
- 응답 캐싱

**장점**
| 항목 | 설명 |
|------|------|
| 보안 | 우수 (서버 검증) |
| UX | 좋음 (로딩 시간 단축) |
| 구현 | 간단 |
| 유지보수 | 쉬움 |

**단점**
| 항목 | 설명 |
|------|------|
| 네트워크 의존 | 서버 응답 대기 필요 |
| 지연 가능 | 네트워크 상황 따라 다름 |

---

### 2. PublicRoute 로직 변경

**설명**
- 인증 대기 중에도 인증된 것으로 가정하고 대시보드로 우선 이동
- 서버 응답 후 실제 인증 상태 확인
- 미인증 시 로그인 페이지로 이동

**장점**
| 항목 | 설명 |
|------|------|
| UX | 매우 좋음 (즉시 이동) |
| 네트워크 | 덜 의존 |
| 반응성 | 빠름 |

**단점**
| 항목 | 설명 |
|------|------|
| 보안 | 중간 (클라이언트 우선 처리) |
| 복잡도 | 중간 (상태 관리 필요) |

---

### 3. 서버 사이드 리다이렉트

**설명**
- nginx 또는 Spring Security에서 `/` 요청 시 인증 쿠키 확인
- 인증되어 있으면 서버에서 직접 `/dashboard`로 리다이렉트

**장점**
| 항목 | 설명 |
|------|------|
| 보안 | 최상 (서버 검증) |
| UX | 좋음 (서버에서 처리) |
| 성능 | 좋음 (클라이언트 미의존) |

**단점**
| 항목 | 설명 |
|------|------|
| 구현 | 복잡 (서버 설정 필요) |
| 유지보수 | 어려움 (여러 곳 설정) |

---

## 종합 비교

| 항목 | AuthProvider 최적화 | PublicRoute 변경 | 서버 사이드 |
|------|---------------------|------------------|-------------|
| **보안** | ⭐⭐⭐ 우수 | ⭐⭐ 중간 | ⭐⭐⭐ 우수 |
| **UX** | ⭐⭐⭐ 좋음 | ⭐⭐⭐⭐ 매우좋음 | ⭐⭐⭐ 좋음 |
| **성능** | ⭐⭐ 중간 | ⭐⭐⭐ 좋음 | ⭐⭐⭐ 좋음 |
| **구현 복잡도** | ⭐⭐⭐ 간단 | ⭐⭐ 중간 | ⭐ 어려움 |
| **유지보수** | ⭐⭐⭐ 쉬움 | ⭐⭐ 중간 | ⭐ 어려움 |

---

## 사이드 이펙트 분석

### 현재 문제 원인

```
대시보드에서 '/'로 이동
    ↓
PublicRoute: isLoading=true, isAuthenticated=false → Login 렌더링
    ↓
AuthProvider: PUBLIC_PAGES에 '/' 포함 → 인증 확인 스킵
    ↓
isLoading=false 설정
    ↓
PublicRoute: isAuthenticated=false → Login 유지
```

**원인**: `PUBLIC_PAGES = ['/', '/weather']` → '/'가 있어서 인증 확인을 아예 안 함

### 분석된 파일들

| 파일 | 분석 결과 |
|------|----------|
| AuthProvider.tsx | mountedRef로 마운트 체크 |
| authUtility.ts | 캐싱 + Promise 공유로 race condition 방지 |
| axiosConfig.ts | isProcessingError 플래그로 중복 처리 방지 |

**결론**: race condition 방지가 이미 모든 레벨에서 구현되어 있음

---

## 권장 방안

### 1순위: PUBLIC_PAGES에서 '/' 제거

```typescript
// Before
const PUBLIC_PAGES = ['/', '/weather'];

// After
const PUBLIC_PAGES = ['/weather'];
```

**이유**:
- '/'가 PUBLIC_PAGES에 있어서 인증 확인을 스킵
- 제거하면 AuthProvider에서 인증 확인 수행
- PublicRoute의 기존 로직이 대시보드로 리다이렉트

### 사이드 이펙트

| 항목 | 영향 |
|------|------|
| 대시보드 | PUBLIC_PAGES 인증 확인 로직 실행 (기존과 동일) |
| race condition | 없음 (이미 모든 레벨에서 방지) |
| 보안 | 향상 (인증 확인 수행) |

---

## 결론

**필요한 변경**: `PUBLIC_PAGES = ['/', '/weather']` → `PUBLIC_PAGES = ['/weather']`

**race condition 위험**: 없음 (이미 모든 레벨에서 방지 매커니즘 구현)
